pipeline{
    agent any
    environment{
    PATH="/usr/share/maven:$PATH"
    }
    
    
 stages{
    stage("Git Checkout"){
        steps{
            git credentialsId: 'github', url: 'https://github.com/nikhil-patil96/Maven-Project/'
        }
    }
    stage("Maven Build"){
        steps{
            sh "mvn clean package"
            sh "mv target/*.war target/myweb.war"
        }
    }
    stage("deploy-dev"){
             steps{
             sshagent(['tomcat-new']) {
              sh """
                scp -o StrictHostKeyChecking=no target/myweb.war ubuntu@172.31.13.127:/home/ubuntu/tomcat
                
                ssh ubuntu@172.31.13.127 /home/ubuntu/tomcat/bin/shutdown.sh
                
                 ssh ubuntu@172.31.13.127 /home/ubuntu/tomcat/bin/startup.sh
                
              """
             }
        }
    }
 }
 
}
